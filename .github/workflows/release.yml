name: Create Release on Tag

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      # 1. ë ˆí¬ì§€í† ë¦¬ ì²´í¬ì•„ì›ƒ
      - name: Checkout repository
        uses: actions/checkout@v3

      # 2. ì´ì „ íƒœê·¸ì™€ ë¹„êµí•´ ì»¤ë°‹ ë¡œê·¸ë¥¼ ì¹´í…Œê³ ë¦¬ë³„ë¡œ ì¶”ì¶œ
      - name: Generate Changelog
        id: changelog
        run: |
          # íŒŒì¼ ì´ˆê¸°í™”
          echo "## ğŸš€ New Release: ${{ github.ref_name }}" > changelog.txt
          echo "" >> changelog.txt
          
          # Features ì„¹ì…˜
          echo "### âœ¨ Features" >> changelog.txt
          git log $(git describe --tags --abbrev=0)..HEAD --pretty=format:"- %s [%an]" | grep '^feat:' || echo "- No new features" >> changelog.txt
          echo "" >> changelog.txt

          # Fixes ì„¹ì…˜
          echo "### ğŸ› Bug Fixes" >> changelog.txt
          git log $(git describe --tags --abbrev=0)..HEAD --pretty=format:"- %s [%an]" | grep '^fix:' || echo "- No bug fixes" >> changelog.txt
          echo "" >> changelog.txt

          # Chores ì„¹ì…˜
          echo "### ğŸ”§ Chores" >> changelog.txt
          git log $(git describe --tags --abbrev=0)..HEAD --pretty=format:"- %s [%an]" | grep '^chore:' || echo "- No chores" >> changelog.txt
          echo "" >> changelog.txt

          # ê¸°íƒ€ ë³€ê²½ ì‚¬í•­
          echo "### ğŸ“‹ Other Changes" >> changelog.txt
          git log $(git describe --tags --abbrev=0)..HEAD --pretty=format:"- %s [%an]" | grep -v -E '^feat:|^fix:|^chore:' || echo "- No other changes" >> changelog.txt
          echo "" >> changelog.txt

          # ë³€ê²½ëœ ë‚´ìš© í”„ë¦°íŠ¸ (ë””ë²„ê¹…ìš©)
          echo "Generated Changelog:"
          cat changelog.txt

      # 3. GitHub Release ìƒì„±
      - name: Create GitHub Release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref }}
          name: ğŸš€ Release ${{ github.ref_name }}
          body_path: ./changelog.txt
        env:
          GITHUB_TOKEN: ${{ secrets.MY_GITHUB_TOKEN }}
